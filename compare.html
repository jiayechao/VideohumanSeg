<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bootstrap demo</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"  crossorigin="anonymous">
  <style>
    .module {
      background-color: #cce5ff;
    }
  </style>
</head>

<body>
    <div class="mb-3 p-2 module module1">
      <div class="mb-3">
        <label for="staticEmail" class="col-sm-2 col-form-label">单程花费（元）：</label>
        <input type="number" class="form-control pay" id="staticEmail">
      </div>
      <div class="mb-3">
        <label for="inputPassword" class="col-sm-2 col-form-label">搭乘次数（趟）：</label>
        <input type="number" class="form-control count" id="inputPassword">
      </div>
    </div>
    <div class="container">
      <div class="text-center">
        <!-- <button type="button" class="btn btn-warning" onclick="createModule()">多种搭乘方式</button> -->
        <button type="button" class="btn btn-primary" onclick="computeResult()">生成结果</button>
      </div>
      <div class="mt-3">
        <label for="result" class="col-sm-2 col-form-label">原方案总共花费（元）：</label></label>
        <input type="number" readonly class="form-control count" id="result1">
      </div>
      <div class="mt-3">
        <label for="result" class="col-sm-2 col-form-label">新方案总共花费（元）：</label></label>
        <input type="number" readonly class="form-control count" id="result2">
      </div>
    </div>

    <div id="main" style="width: 100vw; height:400px;"></div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
  <script>
    function planA(pay, count) {
      let i = 1
      let r = 0
      while (i <= count) {
        if (i < 16) {
          r += pay
          i += 1
        }
        else {
          r += (pay * 0.6)
          i += 1
        }
      }
      return Math.round(r)
    }
    function planB(pay, count) {
      let i = 1
      let r = 0
      while (i <= count) {
        if (r < 80) {
          r += pay
          i += 1
        }
        else if (r >= 80 && r < 200) {
          r += (pay * 0.8)
          i += 1
        }
        else {
          r += (pay * 0.5)
          i += 1
        }
      }
      return Math.round(r)
    }

    //-------------------------生成结果---------------------------------------
    function computeResult() {
      let resultA = 0
      let resultB = 0
      const modules = $('.module')
      for (let i = 0; i <modules.length; i++) {
        const pay = parseFloat(modules[i].getElementsByClassName('pay')[0].value)
        const count = parseFloat(modules[i].getElementsByClassName('count')[0].value)
        
        if(!pay || !count){
          alert('请填写正确的数据')
          return
        }
        
        resultA += planA(pay, count)
        resultB += planB(pay, count)
      }
      $('#result1').val(resultA)
      $('#result2').val(resultB)

      return [resultA, resultB]
    }

    // 新增
    function createModule() {
      const str = $(`<div class="mb-3 p-2 module module1">
        <div class="mb-3">
          <label for="staticEmail" class="col-sm-2 col-form-label">单程花费（元）：</label>
          <input type="number" class="form-control pay" id="staticEmail">
        </div>
        <div class="mb-3">
          <label for="inputPassword" class="col-sm-2 col-form-label">搭乘次数（趟）：</label>
          <input type="number" class="form-control count" id="inputPassword">
        </div>
      </div>`)

      const modules = $('.module1')
      modules[modules.length - 1].after(str[0])
    }

    function sumArray(oldArray, n) {
      let r = 0
      for (let i = 0; i <= n; i++) {  
        r += oldArray[i]
      }
      // 返回新数组  
      return r;  
    }

    function createChart() {
      // 基于准备好的dom，初始化echarts实例
      var myChart = echarts.init(document.getElementById('main'));
      const arr = new Array(120).fill(0)
      const pay = parseFloat(document.getElementsByClassName('pay')[0].value)
      // 指定图表的配置项和数据
      var option = {
        tooltip: {
          trigger: 'axis'
        },
        legend: {
          data: ['2元', '3元', '4元','5元','6元','7元','8元','9元','10元']
        },
        grid: {
          left: '3%',
          right: '4%',
          bottom: '3%',
          containLabel: true
        },
        xAxis: {
          type: 'category',
          name: '趟数',
          boundaryGap: false,
          data: arr.map((m,n) => {
            return n + 1
          })
        },
        yAxis: {
          name: '单程话费',
          type: 'value'
        },
        series: [
          {
            name: '2元',
            type: 'line',
            data: arr.map((m,n) => {
              return planA(2, n+1) - planB(2, n+1)
            })
          },
          {
            name: '3元',
            type: 'line',
            data: arr.map((m,n) => {
              return planA(3, n+1) - planB(3, n+1)
            })
          },
          {
            name: '4元',
            type: 'line',
            data: arr.map((m,n) => {
              return planA(4, n+1) - planB(4, n+1)
            })
          },
          {
            name: '5元',
            type: 'line',
            data: arr.map((m,n) => {
              return planA(5, n+1) - planB(5, n+1)
            })
          },
          {
            name: '6元',
            type: 'line',
            data: arr.map((m,n) => {
              return planA(6, n+1) - planB(6, n+1)
            })
          },
          {
            name: '7元',
            type: 'line',
            data: arr.map((m,n) => {
              return planA(7, n+1) - planB(7, n+1)
            })
          },
          {
            name: '8元',
            type: 'line',
            data: arr.map((m,n) => {
              return planA(8, n+1) - planB(8, n+1)
            })
          },
          {
            name: '9元',
            type: 'line',
            data: arr.map((m,n) => {
              return planA(9, n+1) - planB(9, n+1)
            })
          },
          {
            name: '10元',
            type: 'line',
            data: arr.map((m,n) => {
              return planA(10, n+1) - planB(10, n+1)
            })
          },
        ]
      };

      // 使用刚指定的配置项和数据显示图表。
      myChart.setOption(option);
    }

    createChart()
    </script>
</body>

</html>